(()=>{(function(){let e=document.getElementsByClassName("copy-to-clipboard-anchor");for(var o=0;o<e.length;o++){let t=e[o];t.onclick=()=>{t.classList.toggle("copy-done");var a=document.createElement("textarea"),n=t.children[0].innerHTML;t.className.indexOf("trim")>-1&&(n=n.split(" ").join("")),a.value=n,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),window.setTimeout(function(){t.classList.toggle("copy-done")},800)}}})();(function(){window.showNPSModal=function(){var e=document.getElementById("nps-modal");e&&(e.style.display="block")},window.closeNPSModal=function(){var e=document.getElementById("nps-modal");e&&(e.style.display="none"),window.localStorage.setItem("u",!0)},window.showWeNeedYouModal=function(){var e=document.getElementById("we-need-you-modal");e&&(e.style.display="flex"),window.localStorage.setItem("u",!0)},window.closeWeNeedYouModal=function(){var e=document.getElementById("we-need-you-modal");e&&(e.style.display="none")}})();(function(){try{var e=window.location.pathname,o=window.localStorage.getItem("u")||!1;if(o||e==="/")return;var t=window.sessionStorage.getItem("p")||0;window.sessionStorage.setItem("p",parseInt(t,10)+1),t>=2&&window.showNPSModal(),e.indexOf("/entreprise")===0&&t>=2||e.indexOf("/rechercher")===0&&t>=3||e.indexOf("/justificatif")===0&&t>=2||e.indexOf("/annonces")===0&&t>=2||e.indexOf("/etablissement")===0&&t>=2}catch(a){}})();(()=>{let d={aborted:"Le t\xE9l\xE9chargement a \xE9chou\xE9",started:"Le t\xE9l\xE9chargement a commenc\xE9",pending:"T\xE9l\xE9chargement en cours",retried:"Le t\xE9l\xE9chargement prend plus de temps que pr\xE9vu. Merci de patienter.",downloaded:"Le t\xE9l\xE9chargement a r\xE9ussi"},e="downloadManager";document.addEventListener("alpine:init",()=>{Alpine.data("asyncButton",o=>({init(){let t=document.getElementById(o);t&&(t.style.display="none")}})),Alpine.store("downloadManager",{init(){try{let o=window.localStorage.getItem(e);this.downloads=JSON.parse(o),this.triggerUpdate()}catch(o){window.localStorage.removeItem(e)}},downloads:{},async download(o){let t=await fetch(`/api/inpi-pdf-proxy/create/${o}`),{slug:a}=await t.json(),n=new Date().getTime();this.downloads[a]={slug:a,error:null,name:`Justificatif - ${o}`,href:`/resources/downloads/${a}.pdf`,label:d.started,status:"started",createdAt:n,lastUpdate:n},this.triggerUpdate()},abortDownload(o){delete this.downloads[o],this.saveOnLocalStorage()},async triggerUpdate(){let o=["aborted","downloaded"],t=Object.values(this.downloads).filter(a=>o.indexOf(a.status)===-1).map(a=>a.slug);t.length>0&&((await fetch("/api/inpi-pdf-proxy/status",{method:"POST",body:JSON.stringify(t)}).then(n=>n.json())).forEach(({slug:n,status:i})=>{this.downloads[n].status=i,this.downloads[n].label=d[i],this.downloads[n].lastUpdate=new Date().getTime()}),Object.values(this.downloads).forEach(n=>{new Date().getTime()-n.createdAt>1e3*3600&&this.abortDownload(n.slug)}),window.setTimeout(()=>this.triggerUpdate(),2500),this.saveOnLocalStorage())},saveOnLocalStorage(){window.localStorage.setItem(e,JSON.stringify(this.downloads))}})})})();})();
